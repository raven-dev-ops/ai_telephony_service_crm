<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AI Telephony Admin Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        min-height: 100vh;
        color: #1a202c;
      }
      
      .header-bar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        padding: 1rem 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
      }
      
      .header-content {
        max-width: 1600px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
      }
      
      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .logo {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(30, 58, 138, 0.3);
      }
      
      .logo svg {
        width: 28px;
        height: 28px;
        fill: white;
      }
      
      h1 {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .status-bar {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-left: auto;
        flex-wrap: wrap;
      }
      
      .status-badge {
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }
      
      .status-badge.success {
        background: #d4edda;
        color: #155724;
      }
      
      .status-badge.error {
        background: #f8d7da;
        color: #721c24;
      }
      
      .status-badge.muted {
        background: #e2e8f0;
        color: #64748b;
      }
      
      .status-badge.warning {
        background: #fff3cd;
        color: #856404;
      }
      
      button {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: none;
        background: #1e3a8a;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
      }
      
      button:hover {
        background: #1e40af;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
      }
      
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      
      button.secondary {
        background: #64748b;
      }
      
      button.secondary:hover {
        background: #475569;
      }
      
      button.danger {
        background: #dc2626;
      }
      
      button.danger:hover {
        background: #b91c1c;
      }
      
      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 2rem;
      }
      
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
      }
      
      .card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        transition: all 0.3s;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      
      .card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }
      
      .card-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #f7fafc;
      }
      
      .card-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
      }
      
      .card-icon.warning {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }
      
      .card-icon.success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }
      
      .card-icon.danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      }
      
      .card-icon svg {
        width: 20px;
        height: 20px;
        fill: white;
      }
      
      .card h2 {
        font-size: 1.125rem;
        font-weight: 600;
        color: #2d3748;
        flex: 1;
      }
      
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
      }
      
      .info-item {
        padding: 1rem;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 3px solid #1e3a8a;
      }
      
      .info-label {
        font-size: 0.75rem;
        color: #64748b;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
      }
      
      .info-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1a202c;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
        margin: 1rem 0;
      }
      
      th {
        background: #f8fafc;
        padding: 0.75rem;
        text-align: left;
        font-weight: 600;
        color: #475569;
        border-bottom: 2px solid #e2e8f0;
      }
      
      td {
        padding: 0.75rem;
        border-bottom: 1px solid #f1f5f9;
      }
      
      tr:hover {
        background: #f8fafc;
      }
      
      .status-tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
      }
      
      .status-active {
        background: #d1fae5;
        color: #065f46;
      }
      
      .status-suspended {
        background: #fee;
        color: #991b1b;
      }
      
      input[type="text"],
      input[type="password"],
      input[type="number"],
      select,
      textarea {
        padding: 0.5rem;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        font-family: inherit;
        font-size: 0.875rem;
        transition: all 0.2s;
        width: 100%;
      }
      
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #1e3a8a;
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
      }
      
      label {
        display: block;
        margin-bottom: 0.5rem;
      }
      
      label small {
        font-weight: 600;
        color: #475569;
      }
      
      .form-group {
        margin-bottom: 1rem;
      }
      
      .action-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1rem;
      }
      
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        color: #94a3b8;
      }
      
      .loading::after {
        content: "";
        width: 20px;
        height: 20px;
        border: 3px solid #e2e8f0;
        border-top-color: #1e3a8a;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-left: 0.5rem;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: #94a3b8;
      }
      
      .empty-state svg {
        width: 64px;
        height: 64px;
        fill: #cbd5e1;
        margin-bottom: 1rem;
      }
      
      .alert {
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        display: flex;
        align-items: start;
        gap: 0.75rem;
      }
      
      .alert-warning {
        background: #fffbeb;
        border-left: 4px solid #f59e0b;
        color: #92400e;
      }
      
      .alert-info {
        background: #eff6ff;
        border-left: 4px solid #3b82f6;
        color: #1e3a8a;
      }
      
      .alert-success {
        background: #f0fdf4;
        border-left: 4px solid #10b981;
        color: #065f46;
      }
      
      .alert-danger {
        background: #fef2f2;
        border-left: 4px solid #ef4444;
        color: #991b1b;
      }
      
      .checklist {
        list-style: none;
        padding: 0;
      }
      
      .checklist li {
        padding: 0.75rem;
        margin: 0.5rem 0;
        background: #f8fafc;
        border-radius: 8px;
        display: flex;
        align-items: start;
        gap: 0.75rem;
      }
      
      .checklist li::before {
        content: "âœ“";
        width: 24px;
        height: 24px;
        background: #10b981;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
      }
      
      body.dark {
        background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        color: #e2e8f0;
      }
      
      body.dark .header-bar {
        background: rgba(15, 23, 42, 0.95);
        border-bottom-color: rgba(255, 255, 255, 0.1);
      }
      
      body.dark .card {
        background: #1e293b;
        border-color: rgba(255, 255, 255, 0.1);
      }
      
      body.dark .card h2 {
        color: #e2e8f0;
      }
      
      body.dark th {
        background: #0f172a;
        color: #cbd5e1;
      }
      
      body.dark td {
        border-bottom-color: #334155;
      }
      
      body.dark tr:hover {
        background: #334155;
      }
      
      body.dark input,
      body.dark select,
      body.dark textarea {
        background: #0f172a;
        border-color: #475569;
        color: #e2e8f0;
      }
      
      body.dark .info-item {
        background: #0f172a;
      }
      
      body.dark .checklist li {
        background: #0f172a;
      }
      
      .tour-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      
      .tour-panel {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      }
      
      body.dark .tour-panel {
        background: #1e293b;
        color: #e2e8f0;
      }
      
      .success { color: #059669; }
      .error { color: #dc2626; }
      .muted { color: #64748b; }
    </style>
  </head>
  <body>
    <!-- Tour Overlay -->
    <div id="admin-tour-overlay" class="tour-overlay" aria-hidden="true">
      <div class="tour-panel" role="dialog" aria-modal="true" aria-labelledby="admin-tour-heading">
        <div id="admin-tour-step1">
          <h2 id="admin-tour-heading" style="margin-bottom: 1rem;">Welcome to Admin Dashboard</h2>
          <p style="margin-bottom: 1rem; color: #64748b;">
            Use this view to manage tenants, monitor usage, and keep Twilio webhooks healthy for the platform.
          </p>
          <p style="margin-bottom: 1rem; color: #64748b;">
            Start with the <strong>Tenants</strong> card to see all configured businesses and quick links to their owner dashboards.
          </p>
          <div style="display: flex; gap: 0.5rem;">
            <button id="admin-tour-next" type="button">Next</button>
            <button id="admin-tour-skip" type="button" class="secondary">Skip Tour</button>
          </div>
        </div>
        <div id="admin-tour-step2" style="display: none;">
          <h2 style="margin-bottom: 1rem;">Monitor & Secure</h2>
          <p style="margin-bottom: 1rem; color: #64748b;">
            Use <strong>Tenant Usage</strong> to see activity per tenant, and <strong>Twilio Health</strong> to monitor webhook status.
          </p>
          <p style="margin-bottom: 1rem; color: #64748b;">
            The <strong>Safety Checklist</strong> helps ensure production readiness with key security settings.
          </p>
          <button id="admin-tour-done" type="button">Got It</button>
        </div>
      </div>
    </div>

    <!-- Header -->
    <div class="header-bar">
      <div class="header-content">
        <div class="logo-section">
          <div class="logo">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <div>
            <h1>Admin Dashboard</h1>
            <div style="font-size: 0.75rem; color: #64748b;">Platform Management</div>
          </div>
        </div>
        <div class="status-bar">
          <div id="environment-label-admin" class="status-badge muted">Environment: Loading...</div>
          <div class="action-group" style="margin: 0;">
            <button id="admin-theme-toggle" type="button">ðŸŒ™ Dark</button>
            <button id="test-admin-access" type="button">Test Access</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Container -->
    <div class="container">
      <!-- Admin Key Input -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon warning">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
          </div>
          <h2>Admin Authentication</h2>
        </div>
        <div class="form-group">
          <label>
            <small>Admin API Key (X-Admin-API-Key)</small>
            <input id="admin-key-input" type="password" placeholder="Enter your admin API key" />
          </label>
          <small id="admin-key-status" class="muted"></small>
        </div>
        <div id="demo-banner-admin" class="alert alert-warning" style="display: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
          </svg>
          <div>
            <strong>Demo Environment</strong><br />
            Do not use with real customer data. This is a non-production environment.
          </div>
        </div>
      </div>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Tenants Management -->
        <div class="card" style="grid-column: span 2;">
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
            </div>
            <h2>Tenants</h2>
          </div>
          <div class="form-group">
            <input id="tenant-search" type="text" placeholder="Search by ID or name..." />
          </div>
          <div id="tenants-content">
            <div class="loading">Loading tenants</div>
          </div>
          <button id="refresh-tenants" type="button" style="width: 100%; margin-top: 1rem;">Refresh Tenants</button>
        </div>

        <!-- Tenant Usage -->
        <div class="card" style="grid-column: span 2;">
          <div class="card-header">
            <div class="card-icon success">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </div>
            <h2>Tenant Usage</h2>
          </div>
          <div id="usage-content">
            <div class="loading">Loading usage data</div>
          </div>
          <div class="action-group">
            <button id="refresh-usage" type="button">Refresh</button>
            <button id="download-usage-csv" type="button" class="secondary">Download CSV</button>
          </div>
        </div>

        <!-- Twilio Health -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.5 15.5c-1.2 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.02.24l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.59l2.2-2.21c.28-.26.36-.65.25-1C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1z"/>
              </svg>
            </div>
            <h2>Twilio Health</h2>
          </div>
          <div id="twilio-content">
            <div class="loading">Loading</div>
          </div>
          <button id="refresh-twilio" type="button" style="width: 100%; margin-top: 1rem;">Refresh</button>
        </div>

        <!-- Governance -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
              </svg>
            </div>
            <h2>Governance</h2>
          </div>
          <div id="governance-content">
            <div class="loading">Loading</div>
          </div>
          <button id="refresh-governance" type="button" style="width: 100%; margin-top: 1rem;">Refresh</button>
        </div>

        <!-- Safety Checklist -->
        <div class="card" style="grid-column: span 2;">
          <div class="card-header">
            <div class="card-icon warning">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm-1.06 13.54L7.4 12l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41-5.64 5.66z"/>
              </svg>
            </div>
            <h2>Safety & Production Checklist</h2>
          </div>
          <ul class="checklist">
            <li>
              <div>
                <strong>Admin API Key</strong><br />
                <small>Set <code>ADMIN_API_KEY</code> and protect all <code>/v1/admin/*</code> routes</small>
              </div>
            </li>
            <li>
              <div>
                <strong>Strong Tenancy</strong><br />
                <small>Configure unique per-tenant API keys and set <code>REQUIRE_BUSINESS_API_KEY=true</code></small>
              </div>
            </li>
            <li>
              <div>
                <strong>Twilio Signatures</strong><br />
                <small>Enable <code>VERIFY_TWILIO_SIGNATURES=true</code> and secure <code>TWILIO_AUTH_TOKEN</code></small>
              </div>
            </li>
            <li>
              <div>
                <strong>Database Backend</strong><br />
                <small>Use database-backed repositories for production data persistence</small>
              </div>
            </li>
            <li>
              <div>
                <strong>Session Store</strong><br />
                <small>Use Redis for shared session storage: <code>SESSION_STORE_BACKEND=redis</code></small>
              </div>
            </li>
            <li>
              <div>
                <strong>Environment Separation</strong><br />
                <small>Keep dev/staging/prod separate with distinct credentials</small>
              </div>
            </li>
          </ul>
        </div>

        <!-- Notifications Config -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
              </svg>
            </div>
            <h2>Notifications</h2>
          </div>
          <div class="form-group">
            <label>
              <small>Select Tenant</small>
              <select id="notifications-tenant-select">
                <option value="">Loading...</option>
              </select>
            </label>
          </div>
          <div id="notifications-form">
            <p class="muted"><small>Select a tenant to edit settings</small></p>
          </div>
          <small id="notifications-status"></small>
        </div>

        <!-- Audit Log -->
        <div class="card" style="grid-column: span 2;">
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
              </svg>
            </div>
            <h2>Audit Log</h2>
          </div>
          <div class="info-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
            <div class="form-group">
              <label>
                <small>Tenant ID</small>
                <input id="audit-business-id" type="text" placeholder="optional" />
              </label>
            </div>
            <div class="form-group">
              <label>
                <small>Role</small>
                <select id="audit-role">
                  <option value="">Any</option>
                  <option value="admin">Admin</option>
                  <option value="owner_dashboard">Owner</option>
                  <option value="tenant_api">Tenant API</option>
                  <option value="widget">Widget</option>
                </select>
              </label>
            </div>
            <div class="form-group">
              <label>
                <small>Window</small>
                <select id="audit-since-minutes">
                  <option value="">Any Time</option>
                  <option value="60">Last Hour</option>
                  <option value="240">Last 4 Hours</option>
                  <option value="1440">Last 24 Hours</option>
                </select>
              </label>
            </div>
          </div>
          <div id="audit-content">
            <div class="loading">Loading audit log</div>
          </div>
          <button id="refresh-audit" type="button" style="width: 100%; margin-top: 1rem;">Refresh Audit Log</button>
        </div>

        <!-- Admin Runbook -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon success">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
              </svg>
            </div>
            <h2>Quick Actions</h2>
          </div>
          <div class="action-group">
            <button id="seed-demo-tenants" type="button" style="width: 100%;">Seed Demo Tenants</button>
            <button id="runbook-test-health" type="button" class="secondary" style="width: 100%;">Test Backend Health</button>
            <button id="runbook-test-twilio" type="button" class="secondary" style="width: 100%;">Check Twilio Status</button>
          </div>
          <div style="margin-top: 1rem;">
            <small id="runbook-status" class="muted"></small>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      const DEFAULT_BACKEND_BASE = "http://localhost:8000";
      const backendBase = DEFAULT_BACKEND_BASE;
      let adminKey = localStorage.getItem("admin_api_key") || "";
      let adminTheme = localStorage.getItem("admin_theme") || "light";
      
      if (adminTheme === "dark") {
        document.body.classList.add("dark");
      }

      function adminHeaders() {
        const headers = {};
        if (adminKey) headers["X-Admin-API-Key"] = adminKey;
        return headers;
      }

      async function fetchJson(path, options = {}) {
        const init = {
          headers: { ...adminHeaders(), ...(options.headers || {}) },
          method: options.method || "GET",
        };
        if (options.body) {
          init.body = options.body;
        }
        const res = await fetch(backendBase + path, init);
        if (!res.ok) {
          const text = await res.text().catch(() => "");
          throw new Error("Request failed: " + res.status + (text ? " " + text : ""));
        }
        const contentType = res.headers.get("content-type") || "";
        if (contentType.includes("application/json")) {
          return res.json();
        }
        return res.text();
      }

      function escapeHtml(value) {
        if (value === null || value === undefined) return "";
        return String(value)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      // Admin key handling
      const adminKeyInput = document.getElementById("admin-key-input");
      const adminKeyStatus = document.getElementById("admin-key-status");
      
      if (adminKeyInput && adminKeyStatus) {
        if (adminKey) {
          adminKeyInput.value = adminKey;
          adminKeyStatus.textContent = "Using saved admin key";
          adminKeyStatus.className = "success";
        }
        
        adminKeyInput.addEventListener("change", (e) => {
          adminKey = e.target.value.trim();
          if (adminKey) {
            localStorage.setItem("admin_api_key", adminKey);
            adminKeyStatus.textContent = "Admin key saved";
            adminKeyStatus.className = "success";
          } else {
            localStorage.removeItem("admin_api_key");
            adminKeyStatus.textContent = "Admin key cleared";
            adminKeyStatus.className = "muted";
          }
        });
      }

      // Theme toggle
      const themeToggle = document.getElementById("admin-theme-toggle");
      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          const isDark = document.body.classList.toggle("dark");
          adminTheme = isDark ? "dark" : "light";
          localStorage.setItem("admin_theme", adminTheme);
          themeToggle.textContent = isDark ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";
        });
        themeToggle.textContent = adminTheme === "dark" ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";
      }

      // Test admin access
      const testAdminBtn = document.getElementById("test-admin-access");
      if (testAdminBtn && adminKeyStatus) {
        testAdminBtn.addEventListener("click", async () => {
          try {
            await fetchJson("/v1/admin/businesses");
            adminKeyStatus.textContent = "Admin access OK";
            adminKeyStatus.className = "success";
          } catch (err) {
            adminKeyStatus.textContent = "Admin access failed: " + String(err.message || err);
            adminKeyStatus.className = "error";
          }
        });
      }

      // Load environment
      async function loadAdminEnvironment() {
        const label = document.getElementById("environment-label-admin");
        const demoBanner = document.getElementById("demo-banner-admin");
        if (!label) return;
        
        try {
          const info = await fetchJson("/v1/admin/environment");
          const env = String(info.environment || "dev").toLowerCase();
          
          if (env === "prod" || env === "production") {
            label.className = "status-badge success";
            label.textContent = "Environment: Production";
            if (demoBanner) demoBanner.style.display = "none";
          } else if (env === "staging") {
            label.className = "status-badge warning";
            label.textContent = "Environment: Staging";
            if (demoBanner) demoBanner.style.display = "block";
          } else {
            label.className = "status-badge muted";
            label.textContent = "Environment: Development";
            if (demoBanner) demoBanner.style.display = "block";
          }
        } catch (err) {
          label.textContent = "Environment: Unknown";
          label.className = "status-badge error";
          if (demoBanner) demoBanner.style.display = "block";
        }
      }

      // Placeholder load functions (simplified for demo)
      async function loadTenants() {
        const el = document.getElementById("tenants-content");
        if (!el) return;
        el.innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3z"/></svg><p>No tenants configured yet</p><small>Use the Quick Actions to seed demo tenants</small></div>';
      }

      async function loadUsage() {
        const el = document.getElementById("usage-content");
        if (!el) return;
        el.innerHTML = '<div class="empty-state"><p>No usage data available</p></div>';
      }

      async function loadTwilioHealth() {
        const el = document.getElementById("twilio-content");
        if (!el) return;
        el.innerHTML = `
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Voice Requests</div>
              <div class="info-value">0</div>
            </div>
            <div class="info-item">
              <div class="info-label">SMS Requests</div>
              <div class="info-value">0</div>
            </div>
          </div>
        `;
      }

      async function loadGovernance() {
        const el = document.getElementById("governance-content");
        if (!el) return;
        el.innerHTML = `
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Tenants</div>
              <div class="info-value">0</div>
            </div>
            <div class="info-item">
              <div class="info-label">Multi-Tenant</div>
              <div class="info-value">No</div>
            </div>
          </div>
        `;
      }

      async function loadAudit() {
        const el = document.getElementById("audit-content");
        if (!el) return;
        el.innerHTML = '<div class="empty-state"><p>No audit events</p></div>';
      }

      // Wire buttons
      document.getElementById("refresh-tenants")?.addEventListener("click", loadTenants);
      document.getElementById("refresh-usage")?.addEventListener("click", loadUsage);
      document.getElementById("refresh-twilio")?.addEventListener("click", loadTwilioHealth);
      document.getElementById("refresh-governance")?.addEventListener("click", loadGovernance);
      document.getElementById("refresh-audit")?.addEventListener("click", loadAudit);

      // Tour functionality
      const tourOverlay = document.getElementById("admin-tour-overlay");
      const tourStep1 = document.getElementById("admin-tour-step1");
      const tourStep2 = document.getElementById("admin-tour-step2");
      
      if (tourOverlay && tourStep1 && tourStep2) {
        const dismissed = localStorage.getItem("admin_tour_dismissed");
        
        if (dismissed !== "1") {
          tourOverlay.style.display = "flex";
        }
        
        document.getElementById("admin-tour-next")?.addEventListener("click", () => {
          tourStep1.style.display = "none";
          tourStep2.style.display = "block";
        });
        
        const closeTour = () => {
          localStorage.setItem("admin_tour_dismissed", "1");
          tourOverlay.style.display = "none";
        };
        
        document.getElementById("admin-tour-done")?.addEventListener("click", closeTour);
        document.getElementById("admin-tour-skip")?.addEventListener("click", closeTour);
      }

      // Initial load
      loadAdminEnvironment();
      loadTenants();
      loadUsage();
      loadTwilioHealth();
      loadGovernance();
      loadAudit();
    </script>
  </body>
</html>